<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="EleCannonic">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
        
        
        
            <link rel="preconnect" href="https://evan.beee.top" crossorigin>
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://elecannonic.github.io/categories/electronics/read_e203/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Build Real Science.">
<meta property="og:type" content="article">
<meta property="og:title" content="Let&#39;s Read hbird_e203 CPU Together">
<meta property="og:url" content="https://elecannonic.github.io/categories/electronics/read_e203/index.html">
<meta property="og:site_name" content="CENTER OF ELECANNONIC">
<meta property="og:description" content="Build Real Science.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://elecannonic.github.io/images/redefine-og.webp">
<meta property="article:published_time" content="2025-09-08T16:00:00.000Z">
<meta property="article:modified_time" content="2025-12-27T10:11:07.735Z">
<meta property="article:author" content="EleCannonic">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://elecannonic.github.io/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            Let&#39;s Read hbird_e203 CPU Together | CENTER OF ELECANNONIC
        
    </title>

    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/fonts/Chillax/chillax.css">

    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/css/build/tailwind.css">
    

    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/fonts/GeistMono/geist-mono.css">
    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/fonts/Geist/geist.css">
    <!--- Font Part-->
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"elecannonic.github.io","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"18px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"2.5rem","h2":"2.2rem","h3":"1.8rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"simple","highlight_theme":{"light":"github","dark":"github-dark"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":null,"limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"dark"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Build Real Science."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/background_light.png","dark":"/images/background_dark.png"},"title":"Build Real Science.","subtitle":{"text":[],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000","dark":"#d1d1b6"},"text_style":{"title_size":"3.5rem","subtitle_size":"1.2rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"}},"version":"2.8.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Tech":{"icon":"fa-regular fa-microchip","submenus":{"math":"/categories/math","physics":"/categories/physics","electronics":"/categories/electronics"}},"Solutions":{"path":"/categories/solutions","icon":"fa-regular fa-newspaper"},"Profile":{"icon":"fa-regular fa-user","submenus":{"About":"/about","Github":"https://github.com/EleCannonic","Friends":"/links"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":null},"article_date_format":null,"excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":false,"limit":3}},"footerStart":"2025/5/28 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/logo.png" class="w-full h-full rounded-sm">
                </a>
            
            <a class="logo-title" href="/">
                
                CENTER OF ELECANNONIC
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-microchip fa-fw"></i>
                                    TECH
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/categories/math">
                                                    MATH
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a href="/categories/physics">
                                                    PHYSICS
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a href="/categories/electronics">
                                                    ELECTRONICS
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories/solutions"
                                        >
                                    <i class="fa-regular fa-newspaper fa-fw"></i>
                                    SOLUTIONS
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    PROFILE
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about">
                                                    ABOUT
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/EleCannonic">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a href="/links">
                                                    FRIENDS
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Tech"
                        >
                            <span>
                                TECH
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Tech">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/categories/math">MATH</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/categories/physics">PHYSICS</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/categories/electronics">ELECTRONICS</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories/solutions"
                        >
                            <span>
                                SOLUTIONS
                            </span>
                            
                                <i class="fa-regular fa-newspaper fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Profile"
                        >
                            <span>
                                PROFILE
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Profile">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about">ABOUT</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/EleCannonic">GITHUB</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/links">FRIENDS</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">4</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">11</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Let&#39;s Read hbird_e203 CPU Together</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/personal.png">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">EleCannonic</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-09-09</span>
        <span class="mobile">2025-09-09</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-12-27 18:11:07</span>
            <span class="mobile">2025-12-27 18:11:07</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/electronics/">electronics</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<p><strong>Note: This article is merely a thought process. Please do not use it as a handout, as it does not provide enough information for systematic learning. Using it as a reference is OK, though.</strong></p>
<p>As a start to deep dive into the world of CPU,<br>hbird_e203 is a good project. </p>
<p>The following is the project link: <a class="link" target="_blank" rel="noopener" href="https://github.com/riscv-mcu/e203_hbirdv2">Hummingbird E203<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<h2 id="1-Instruction-Set-Architecture-ISA"><a href="#1-Instruction-Set-Architecture-ISA" class="headerlink" title="1. Instruction Set Architecture (ISA)"></a>1. Instruction Set Architecture (ISA)</h2><p>hbird_e203 applies RISC-V ISA,<br>which is designed simply.<br>Instrictions in RISC-V ISA are ordered strictly.</p>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_ins.png" width="400" height="300">  
</div>  
<center>Format of RISC-V Instructions</center> 

<p>RISC-V only supports little-endian.<br>What is little-endian and big-endian?<br>Well, let’s use a figure to interpret:</p>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_endian.png" width="400" height="300">  
</div>  
<center>Interpretation of Little-Endian and Big-Endian</center> 

<p>If the ISA applies little-endian,<br>the data stored is <code>0x78563412</code>.<br>If big-endian,<br>it should be <code>0x12345678</code>.</p>
<h2 id="2-Standard-DFF-Registers"><a href="#2-Standard-DFF-Registers" class="headerlink" title="2. Standard DFF Registers"></a>2. Standard DFF Registers</h2><p>hbird_e203 uses modulized, standard DFF module to construct registers,<br>instead of using <code>always</code> block.</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">wire</span> flg_r; <span class="comment">// output signal</span></span><br><span class="line"><span class="keyword">wire</span> flg_nxt = ~flg_r; <span class="comment">// input signal</span></span><br><span class="line"><span class="keyword">wire</span> flg_ena = (ptr == ('E203_OITF_DEPTH-<span class="number">1</span>) &amp; ptr_ena);</span><br><span class="line"></span><br><span class="line"><span class="comment">// instantiating standard DFF modules</span></span><br><span class="line">sirv_gnrl_dfflr <span class="variable">#(1) flg_dfflrs(flg_ena, flg_nxt, flg_r, clk, rst_n)</span>;</span><br></pre></td></tr></table></figure></div>

<p>In another module, <code>sirv_gnrl_dfflr</code> is designed below:</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> sirv_gnrl_dfflr # (</span><br><span class="line">    <span class="keyword">parameter</span> DW = <span class="number">32</span> <span class="comment">// This is a 32bit width DFF, by transmitting parameter DW can be vaired.</span></span><br><span class="line">) (</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span>               lden, </span><br><span class="line">    <span class="keyword">input</span>      [DW-<span class="number">1</span>:<span class="number">0</span>] dnxt,</span><br><span class="line">    <span class="keyword">output</span>     [DW-<span class="number">1</span>:<span class="number">0</span>] qout,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span>               clk,  <span class="comment">// clock</span></span><br><span class="line">    <span class="keyword">input</span>               rst_n <span class="comment">// negative valid reset, synchronous</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [DW-<span class="number">1</span>:<span class="number">0</span>] qout_r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line">    <span class="keyword">begin</span> : DFFLR_PROC <span class="comment">// DFFLR_PROC is just a label of this always block. No effect on functions.</span></span><br><span class="line">        <span class="keyword">if</span> (rst_n == <span class="number">1'b0</span>)</span><br><span class="line">            qout_r &lt;= {DW{<span class="number">1'b0</span>}}; <span class="comment">// reset, output pull down</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lden == <span class="number">1'b1</span>)</span><br><span class="line">            qout_r &lt;= #<span class="number">1</span> dnxt;</span><br><span class="line">            <span class="comment">// #1: delay of 1 time-unit. No effect in synthesis. Debug method in simulation.</span></span><br><span class="line">            <span class="comment">// dnxt: data to be assigned</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> qout = qout_r;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// introduce a checker, conditional compile.</span></span><br><span class="line">    <span class="comment">// only used in simulation, no hardware circuit produced</span></span><br><span class="line">    <span class="meta">`<span class="keyword">ifndef</span> FPGA_SOURCE</span><span class="comment">//{</span></span><br><span class="line">    <span class="meta">`<span class="keyword">ifndef</span> DISABLE_SV_ASSERTION</span><span class="comment">//{</span></span><br><span class="line">    <span class="comment">//synopsys translate_off</span></span><br><span class="line">        sirv_gnrl_xchecker # (</span><br><span class="line">        <span class="variable">.DW</span>(<span class="number">1</span>)</span><br><span class="line">        ) sirv_gnrl_xchecker(</span><br><span class="line">        <span class="variable">.i_dat</span>(lden),</span><br><span class="line">        <span class="variable">.clk</span>  (clk)</span><br><span class="line">        );</span><br><span class="line">    <span class="comment">//synopsys translate_on</span></span><br><span class="line">    <span class="meta">`<span class="keyword">endif</span></span><span class="comment">//}</span></span><br><span class="line">    <span class="meta">`<span class="keyword">endif</span></span><span class="comment">//}</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure></div>
<p>Using standard modules,<br>it’s convenient to replace type of registers or insert delay globally.<br>The <code>xchecker</code> module captures undefined state.<br>Once detected, it reports an error and aborts simulation.</p>
<h2 id="3-if-else-and-assign"><a href="#3-if-else-and-assign" class="headerlink" title="3. if-else and assign"></a>3. <code>if-else</code> and <code>assign</code></h2><p>This project recommends replacing <code>if-else</code> with <code>assign</code>.<br>Because <code>if-else</code> has two major drawback:</p>
<ul>
<li><p><code>if-else</code> cannot transmit undefined state <code>X</code>.</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(flg)</span><br><span class="line">    out = in1;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    out = in2;</span><br></pre></td></tr></table></figure></div>
<p>If <code>flg == X</code>, verilog will equate this to <code>flg == 0</code>,<br>the final output will be <code>out = in2</code>,<br>which did not transmit <code>X</code> state. </p>
<p>However, if <code>assign</code> used</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> out = flg ? in1 : in2;</span><br></pre></td></tr></table></figure></div>
<p>The <code>X</code> state will be transmitted.<br>Such transmission will make debug easier.</p>
</li>
<li><p><code>if-else</code> will be synthesised as a priority MUX,<br>which brings large area and worse timing.<br>Let’s take the MUX below for example:</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (sel1)</span><br><span class="line">    out = in1[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (sel2)</span><br><span class="line">    out = in2[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (sel3)</span><br><span class="line">    out = in3[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    out = <span class="number">4'b0</span>;</span><br></pre></td></tr></table></figure></div>
<p>After synthesis, this code turns to</p>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_pr_mux.png" width="400" height="300">  
</div>  
<center>Priority MUX</center></li>
</ul>
<p>3 MUX will obviously occupy larger area.<br>But if we use <code>assign</code>:</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> out =   ({<span class="number">4</span>{sel1}} &amp; in1[<span class="number">3</span>:<span class="number">0</span>])</span><br><span class="line">             | ({<span class="number">4</span>{sel2}} &amp; in2[<span class="number">3</span>:<span class="number">0</span>])</span><br><span class="line">             | ({<span class="number">4</span>{sel3}} &amp; in3[<span class="number">3</span>:<span class="number">0</span>]);</span><br></pre></td></tr></table></figure></div>
<p>This is a parallel, gating MUX.<br>The <code>sel</code> signals act as gating controls,<br>which are parallel for the three <code>in</code> signals.<br>It will be synthesised as</p>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_pa_mux.png" width="400" height="300">  
</div>  
<center>Parallel MUX</center> 

<h2 id="4-Data-Hazard"><a href="#4-Data-Hazard" class="headerlink" title="4. Data Hazard"></a>4. Data Hazard</h2><ul>
<li><p>RAW (Read After Write)<br>Suppose instruction <code>j</code> needs an operation number,<br>which should be provided by instruction <code>i</code>.<br>Hence, WB of <code>i</code> must be executed before the register reading of <code>j</code>.</p>
<p>For example:</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i: ADD x1, x2, x3 ; (x2 + x3 -&gt; x1)</span><br><span class="line">j: SUB x4, x1, x5 ; (x1 - x5 -&gt; x4)</span><br></pre></td></tr></table></figure></div>

<p>In a pipeline,<br>when <code>j</code> is executing ID,<br><code>i</code> might be still executing EX,<br>the result hasn’t been written into the register file yet.<br>In this situation, <code>j</code> will read a wrong operation number.</p>
<p>To solve the problem,<br>the pipeline can apply a stalling to pause the following instructions,<br>waiting for WB of <code>i</code>.<br>But the most usual method is Data Forwarding.<br>CPU will send the result of EX or MEM of <code>i</code> to <code>j</code> directly,<br>instead of waiting for <code>i</code>.<br>This method increases efficiency compared to stalling.</p>
</li>
<li><p>WAR (Write After Read)<br>Instruction <code>j</code> tries to write in a register,<br>but another instruction <code>i</code> needs to read the operation number in this register.<br>Reading of <code>i</code> must be completed before writing of <code>j</code>.</p>
<p>Example:</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i: SUB x4, x1, x5  ; read x1</span><br><span class="line">j: ADD x1, x2, x3  ; write x1</span><br><span class="line">k: MUL x6, x1, x7  ; read x1</span><br></pre></td></tr></table></figure></div>

<p>If the pipeline is in-order,<br>it has no problem.<br>However, in an out-of-order pipeline,<br>if <code>x2</code> and <code>x3</code> are ready ahead of time,<br><code>j</code> may finish executing before <code>i</code>.<br>Then <code>i</code> will give a wrong result.</p>
<p>To solve, CPU will rename the registers.</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i: SUB x4, P1, x5   ; // P1 for old x1 value</span><br><span class="line">j: ADD P2, x2, x3   ; // P2 for new x1 value, unrelated with P1</span><br><span class="line">k: MUL x6, P2, x7   ; // Use new value</span><br></pre></td></tr></table></figure></div>

<p>To achieve renaming,<br>the CPU will create a map from the external register file (ISA registers) to the internal registers.<br>Then the writing and reading will not influence each other anymore.</p>
</li>
<li><p>WAW (Write After Write)<br>Two instructions, <code>i</code> and <code>j</code>,<br>both needs to write a number into the same register.<br>The correct order is <code>i</code> first and <code>j</code> second.<br>The same, WAW also occurs in an out-of-order pipeline.<br>If <code>j</code> finishes first,<br>the final result should be that of <code>i</code>, which is wrong.</p>
<p>The solution is also Renaming.</p>
</li>
</ul>
<h2 id="5-Instruction-Fetch-IF"><a href="#5-Instruction-Fetch-IF" class="headerlink" title="5. Instruction Fetch (IF)"></a>5. Instruction Fetch (IF)</h2><p>The final target of IF is to be ‘fast’ and ‘continuously’.</p>
<h3 id="ITCM"><a href="#ITCM" class="headerlink" title="ITCM"></a>ITCM</h3><p>To make IF faster,<br>we need to make the read-delay of the memory smaller.<br>General memory may have a delay of dozens of clock period,<br>which is far from meeting our requirements.</p>
<p>In general, a modern CPU creates a small memory (dozens of KB)<br>used for store instructions,<br>which is physically close to the core.<br>This memory is called ITCM (Instriction Tightly Coupled Memory).</p>
<p>ITCM is not DDR or cache.<br>It is just a small memory with specific address.<br>The delay is predictable compared to cache.<br>Hence, in situations with high performance requirements,<br>engineers prefer to use ITCM.</p>
<h3 id="Non-aligned-Instructions"><a href="#Non-aligned-Instructions" class="headerlink" title="Non-aligned Instructions"></a>Non-aligned Instructions</h3><p>RISC-V support compressed instructions (C expansion).<br>CPU has to deal with a mixture of 32-bit and 16-bit instructions.<br>So how CPU know it is a 32-bit or a 16-bit instruction?</p>
<p><strong>The least significant two bits of the opcode for a 32-bit RISC-V instruction must be <code>0b11</code>.</strong></p>
<p>CPU distinguishes the instructions according to the least two significant bits (call it LS2B below).<br>If the LS2B is <code>0b11</code>, it is 32bit;<br>If not, it is 16bit.</p>
<p>So how CPU deal with them?<br>Let’s clarify the flow in detail.</p>
<ul>
<li><p>Components</p>
<ul>
<li>Fetch Width: For efficiency, CPU will take more than a halfword from ITCM a time.<br>It usually takes more, for example 32bits.</li>
<li>Instruction Prefetch Queue (IPQ):<br>A FIFO between IFU and the decoder. </li>
<li>RISC-V Rule:<br>If <code>LS2B = 0b11</code>, it is a 32bit instruction; or it is a 16bit one</li>
</ul>
</li>
<li><p>Working Flow</p>
<ul>
<li><p>According to PC value, IFU takes a word (32bit) from ITCM and inserts them into the bottom of IPQ.</p>
</li>
<li><p>ID get a halfword (16bit) from the top of IPQ, then judge whether it is a compressed instruction.</p>
<ul>
<li><p>Situation A: It is a 16bit compressed instruction</p>
<p>ID consumes the first 16bits in IPQ and sends them to the following sections as a entire instruction.<br>Pointer of IPQ moves 2 bytes.</p>
</li>
<li><p>Situation B: It is part of a 32bit instruction</p>
<p>ID needs more data. It consumes the first 32bits in IPQ and then sends them to the following section.<br>Pointer of IPQ moves 4 bytes.</p>
</li>
</ul>
</li>
<li><p>These steps will be repeated.<br>When the data in the IPQ is less than 32 bits,<br>the IFU will perform the next 32-bit read operation and pad the data to the end of the IPQ.</p>
</li>
</ul>
</li>
</ul>
<h3 id="Branch-Instructions"><a href="#Branch-Instructions" class="headerlink" title="Branch Instructions"></a>Branch Instructions</h3><p>There are two types of branch instructions in RISC-V.</p>
<ul>
<li><p>Unconditional Jump: Judgement conditions unnecessary.<br>There are also two types of unconditional jump。</p>
<ul>
<li><p>Direct: Target address can be directly calculated by <code>imm</code> in the instruction.</p>
<p>Example: <code>jal x5, imm</code>, <code>imm</code> is 20 bit, jump to address <code>2*imm + PC</code>.</p>
</li>
<li><p>Indirect: Target address needs to be calculated from data in the register file.</p>
<p>Example: <code>jalr x1, x6, imm</code>, <code>imm</code> is 12 bit, jump to address <code>imm + x6</code>.</p>
</li>
</ul>
</li>
<li><p>Conditional Jump: Jump with conditions<br>Still, two types: Direct and Indirect. But there are no indirect instructions in RISC-V.</p>
</li>
</ul>
<h3 id="Branch-Prediction"><a href="#Branch-Prediction" class="headerlink" title="Branch Prediction"></a>Branch Prediction</h3><p>Solve two problems: </p>
<ul>
<li>Whether to jump (Direction)</li>
<li>What’s the target address (Address)</li>
</ul>
<p>Static prediction: Always predicting the same outcome or following a fixed pattern. (BTFN)</p>
<p>Jump direction: Target PC &lt; Present PC, called back; otherwise called forward.</p>
<p>Dynamic: </p>
<ul>
<li><p>1 bit Saturating: Using the last direction to predict.<br>Modify when meeting a mistake.</p>
</li>
<li><p>2 bit Saturating:</p>
<p>Look at the state machine:</p>
</li>
</ul>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_2bs.png" width="800" height="600">  
</div>  
<center>2 bit Saturating Counter FSM Chart</center> 

<p>2 bit Saturating is effective in predicting one instruction.<br>But for many instructions (At different PC address) not.<br>(They will conflict)<br>Ideally each jump instruction should have its own predictor,<br>which will bring unacceptable hardware cost.<br>So in practice there’re only finite predictors forming a table (Branch Prediction Table).</p>
<p>Accurate prediction procedure: <strong>Indexing</strong></p>
<ul>
<li>One instruction enters the pipeline, with <code>PC = 0x12345678</code>.</li>
<li>CPU take lower significant sevral bits (10 for example), index <code>0x678 = 0d1656</code>.</li>
<li>CPU accesses BPT with index <code>0d1656</code>, find a 2 bit saturating predictor.</li>
<li>Prediction run by predictor, update states, …</li>
</ul>
<p>In fact the instructions number is far larger than that of predictors.<br>Hence many different instructions have to use the same predictor.<br>This problem is called <strong>Aliasing</strong>.</p>
<p>There is a more complicated method, but with better performance,<br>called <strong>Correlation-Based Branch Predictor</strong>.</p>
<ul>
<li>Why we need it</li>
</ul>
<p>Consider a code</p>
<div class="code-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &gt; <span class="number">10</span>) { <span class="comment">// branch A</span></span><br><span class="line">  Hajimi nameiluduo axigaaxi;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Dingdongji Dingdongji, Dagou Dagou Jiaojiaojiao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (b &gt; <span class="number">20</span> &amp;&amp; a &gt; <span class="number">10</span>) { <span class="comment">// branch B</span></span><br><span class="line">  Axiga Yakunalu Hajimi Haji;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>

<p>Whether B jumps dependes on both <code>b &gt; 20</code> and the result of branch A.<br>If A did not jump, B must not jump.<br>A single predictor table cannot deal with such a situation.</p>
<p>Two components:</p>
<ul>
<li>Global History Register (GHR): Width <code>N</code>, record results of recent <code>N</code> instructions.</li>
<li>Pattern History Table (PHT): An array composed by 2bit counters.</li>
</ul>
<p>Index method: <code>PC ^ GHR</code>.<br>The 2bit counters record “when global history is in certain pattern, how branch B will act”,<br>instead of history of branch B itself.</p>
<p><strong>Procedure</strong>:</p>
<p>Suppose GHR has 2bit width. Initial state <code>00</code>.</p>
<ul>
<li><p>Execution 1: suppose <code>a = 5</code>, A not jump, recorded as <code>0</code>, GHR left shift, fill <code>0</code> to the LSB of GHR.<br>GHR = <code>00</code>.<br>B not jump, recorded as <code>0</code>, GHR left shift, fill <code>0</code> to the LSB of GHR.</p>
</li>
<li><p>Execution 2: suppose <code>a = 15, b = 25</code>, A jump, GHR = <code>01</code>.<br>Before execute B, produce index, <code>idx = Hash(PC_B, 01)</code>.<br>Find a 2bit counter (suppose initial state to be <code>11</code>,<br>indicates when the last branch jumped, B tends not to jump). </p>
<p>Make prediction: B will not jump.</p>
<p>Actual result: Prediction failed!<br>Counter: <code>11 -&gt; 10</code>.<br>GHR: <code>01 -&gt; 11</code>.</p>
</li>
</ul>
<p>These steps repeat.</p>
<h2 id="6-E200-IFU-Implementation"><a href="#6-E200-IFU-Implementation" class="headerlink" title="6. E200 IFU Implementation"></a>6. E200 IFU Implementation</h2><p>RISC-V put the length indicator on the lowest significant bits.<br>Hence, the IF logic can recognize the length right after it fetches the lowest bits.<br>What’s more,<br>since the compressed instruction set is optional,<br>if the CPU is not designed to support compressed set,<br>it can directly ignore the lowest bits,<br>which can save about 6.25 I-cache cost.</p>
<h3 id="Overall-Design-Concept"><a href="#Overall-Design-Concept" class="headerlink" title="Overall Design Concept"></a>Overall Design Concept</h3><p>IFU module has such a micro-architechture:</p>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_ifu_str.png" width="800" height="600">  
</div>  
<center>IFU Micro-Architechture</center> 

<p>It tries to fetch instructions “fast” and “continuously”.<br>E203 assumes most instructions are stored in ITCM,<br>for it is designed for ultra-low power, embedded cases,<br>it will never load long codes.<br>Usually the codes can all be loaded in ITCM.</p>
<p>IF module can fetch an instruction in just one period,<br>which has reached the requirement of fast.<br>When it need to fetch instructions from BIU,<br>there will be more delay but such cases are much less than ITCM,<br>so E203 made no optimization for these cases<br>(for higher performance, maybe such optimization is necessary, though).</p>
<p>For “continuously”,<br>each time IF should predict the next <code>PC</code> value.<br>IF partly decodes the fetched instruction and judges whether it needs to jump.<br>If yes,<br>branch predictor runs in the same period,<br>and IF uses the result and decoded information to generate next <code>PC</code>.</p>
<h3 id="Mini-decode"><a href="#Mini-decode" class="headerlink" title="Mini-decode"></a>Mini-decode</h3><p>This module just needs to judge whether it is a general instruction or branch instruction.<br>To simplify design process,<br>this module is implemented by instantiating a complete decode module<br>with unrelated input grounded and output unconneted.<br>Synthesis tools optimize the redundant logics and finally achieve a mini-decode.</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> "e203_defines.v"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> e203_ifu_minidec(</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The IR stage to Decoder</span></span><br><span class="line">  <span class="keyword">input</span>  [`E203_INSTR_SIZE-<span class="number">1</span>:<span class="number">0</span>] instr,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The Decoded Info-Bus</span></span><br><span class="line">  <span class="keyword">output</span> dec_rs1en,</span><br><span class="line">  <span class="keyword">output</span> dec_rs2en,</span><br><span class="line">  <span class="keyword">output</span> [`E203_RFIDX_WIDTH-<span class="number">1</span>:<span class="number">0</span>] dec_rs1idx,</span><br><span class="line">  <span class="keyword">output</span> [`E203_RFIDX_WIDTH-<span class="number">1</span>:<span class="number">0</span>] dec_rs2idx,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">output</span> dec_mulhsu,</span><br><span class="line">  <span class="keyword">output</span> dec_mul   ,</span><br><span class="line">  <span class="keyword">output</span> dec_div   ,</span><br><span class="line">  <span class="keyword">output</span> dec_rem   ,</span><br><span class="line">  <span class="keyword">output</span> dec_divu  ,</span><br><span class="line">  <span class="keyword">output</span> dec_remu  ,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">output</span> dec_rv32, <span class="comment">// indicate bits of instruction (16bits or 32bits)</span></span><br><span class="line">  <span class="keyword">output</span> dec_bjp,  <span class="comment">// general or branch instructions</span></span><br><span class="line">  <span class="keyword">output</span> dec_jal,  <span class="comment">// whether jal </span></span><br><span class="line">  <span class="keyword">output</span> dec_jalr, <span class="comment">// whether jalr</span></span><br><span class="line">  <span class="keyword">output</span> dec_bxx,  <span class="comment">// whether conditional jump instructions</span></span><br><span class="line">  <span class="keyword">output</span> [`E203_RFIDX_WIDTH-<span class="number">1</span>:<span class="number">0</span>] dec_jalr_rs1idx, <span class="comment">// index of rs1 register for jalr</span></span><br><span class="line">  <span class="keyword">output</span> [`E203_XLEN-<span class="number">1</span>:<span class="number">0</span>] dec_bjp_imm  <span class="comment">// imm of conditional jump</span></span><br><span class="line"></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// a complete decode module</span></span><br><span class="line">  e203_exu_decode u_e203_exu_decode(</span><br><span class="line"></span><br><span class="line">  <span class="variable">.i_instr</span>(instr),</span><br><span class="line">  <span class="variable">.i_pc</span>(`E203_PC_SIZE'b0),</span><br><span class="line">  <span class="comment">// ......</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure></div>

<p>We will research on the decode module in detail<br>in the following sections, not here.</p>
<h3 id="Ready-Valid-Handshake"><a href="#Ready-Valid-Handshake" class="headerlink" title="Ready/Valid Handshake"></a>Ready/Valid Handshake</h3><p>Ready/valid handshake is a protocal to ensure correct transition of data<br>between two equipments.</p>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_handshake.png" width="400" height="300">  
</div>  
<center>Sketch of Handshake Protocal</center> 

<p>The rules are straightforward:<br>data transfer only happens when both <code>ready</code> and <code>valid</code> are ‘<code>1</code>‘ during the same clock cycle.<br>The handshake is a stateless protocol.<br>Neither party needs to remember what happened in previous clock cycles<br>to determine if a data transfer occurs in the current cycle.<br>Furthermore, both parties must operate synchronously and read the control signals on the same clock edge.<br>Because of that, ready/valid isn’t appropriate for clock domain crossing (CDC).</p>
<h3 id="Simple-BPU-Branch-Predictor"><a href="#Simple-BPU-Branch-Predictor" class="headerlink" title="Simple BPU Branch Predictor"></a>Simple BPU Branch Predictor</h3><p>To achieve low power, E203 applies the most simple stationary prediction.<br>For conditional direct jump instructions,<br>a backward jump is predicted to require a jump;<br>otherwise, it is predicted not to require a jump.<br>Meanwhile BPU generates next <code>PC</code> by <code>PC + offset</code>.</p>
<p>The file is in module <code>e203_ifu_litebpu.v</code></p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> "e203_defines.v"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> e203_ifu_litebpu(</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Current PC</span></span><br><span class="line">  <span class="keyword">input</span>  [`E203_PC_SIZE-<span class="number">1</span>:<span class="number">0</span>] pc,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The mini-decoded info </span></span><br><span class="line">  <span class="keyword">input</span>  dec_jal,   <span class="comment">// whether jal</span></span><br><span class="line">  <span class="keyword">input</span>  dec_jalr,  <span class="comment">// whether jalr</span></span><br><span class="line">  <span class="keyword">input</span>  dec_bxx,   <span class="comment">// where conditional jump</span></span><br><span class="line">  <span class="keyword">input</span>  [`E203_XLEN-<span class="number">1</span>:<span class="number">0</span>] dec_bjp_imm,  <span class="comment">// imm of conditional jump, target address is PC + imm</span></span><br><span class="line">  <span class="keyword">input</span>  [`E203_RFIDX_WIDTH-<span class="number">1</span>:<span class="number">0</span>] dec_jalr_rs1idx, <span class="comment">// index of rs1 in jalr</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The IR index and OITF status to be used for checking dependency</span></span><br><span class="line">  <span class="keyword">input</span>  oitf_empty,  <span class="comment">// whether OITF is empty</span></span><br><span class="line">  <span class="keyword">input</span>  ir_empty,    <span class="comment">// whether IR is empty</span></span><br><span class="line">  <span class="keyword">input</span>  ir_rs1en,    <span class="comment">// whether to use rs1 in IR</span></span><br><span class="line">  <span class="keyword">input</span>  jalr_rs1idx_cam_irrdidx, <span class="comment">// whether index of rs1 matches that of IR</span></span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">    If the instruction in IR and the next jalr use the same register, </span></span><br><span class="line"><span class="comment">    jalr_rs1idx_cam_irrdidx = 1</span></span><br><span class="line"><span class="comment">    This signal is used to prevent RAW hazard.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// The add op to next-pc adder</span></span><br><span class="line">  <span class="keyword">output</span> bpu_wait,  </span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">    If dependency detected, bpu_wait = 1,</span></span><br><span class="line"><span class="comment">    pause the pipeline and wait until instruction of IR completes execution.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">output</span> prdt_taken,  <span class="comment">// result, predict to jump -&gt; high</span></span><br><span class="line">  <span class="keyword">output</span> [`E203_PC_SIZE-<span class="number">1</span>:<span class="number">0</span>] prdt_pc_add_op1,  </span><br><span class="line">  <span class="keyword">output</span> [`E203_PC_SIZE-<span class="number">1</span>:<span class="number">0</span>] prdt_pc_add_op2,</span><br><span class="line">  <span class="comment">// predicted_pc = prdt_pc_add_op1 + prdt_pc_add_op2</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">input</span>  dec_i_valid, <span class="comment">// valid for decode</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The RS1 to read regfile</span></span><br><span class="line">  <span class="keyword">output</span> bpu2rf_rs1_ena, <span class="comment">// enable register file to read rs1</span></span><br><span class="line">  <span class="keyword">input</span>  ir_valid_clr, <span class="comment">// clear IR valid</span></span><br><span class="line">  <span class="comment">// when instruction in IR is cleared, dependency can be removed.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">input</span>  [`E203_XLEN-<span class="number">1</span>:<span class="number">0</span>] rf2bpu_x1,  <span class="comment">// read x1 register ()</span></span><br><span class="line">  <span class="keyword">input</span>  [`E203_XLEN-<span class="number">1</span>:<span class="number">0</span>] rf2bpu_rs1, <span class="comment">// other registers for jalr</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// clock and reset (negative valid)</span></span><br><span class="line">  <span class="keyword">input</span>  clk,</span><br><span class="line">  <span class="keyword">input</span>  rst_n</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The JAL and JALR is always jump, bxxx backward is predicted as taken  </span></span><br><span class="line">  <span class="keyword">assign</span> prdt_taken   = (dec_jal | dec_jalr | (dec_bxx &amp; dec_bjp_imm[`E203_XLEN-<span class="number">1</span>]));  </span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  `E203_XLEN is the width of register</span></span><br><span class="line"><span class="comment">  BPU predicts to jump, if instr is jal or jalr.</span></span><br><span class="line"><span class="comment">  For conditional, MSB of dec_bjp_imm determines the symbol of offset.</span></span><br><span class="line"><span class="comment">  1 for negative number, backward jump, predict as taken;</span></span><br><span class="line"><span class="comment">  0 for positive number, forward jump, predict as not-taken.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The JALR with rs1 == x1 have dependency or xN have dependency</span></span><br><span class="line">  <span class="keyword">wire</span> dec_jalr_rs1x0 = (dec_jalr_rs1idx == `E203_RFIDX_WIDTH'd0);</span><br><span class="line">  <span class="comment">// assigned as 1 when jalr uses x0 (value is always 0), a special unconditional jump</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">wire</span> dec_jalr_rs1x1 = (dec_jalr_rs1idx == `E203_RFIDX_WIDTH'd1);</span><br><span class="line">  <span class="comment">// assigned as 1 when jalr uses x1 (used as return address register)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">wire</span> dec_jalr_rs1xn = (~dec_jalr_rs1x0) &amp; (~dec_jalr_rs1x1);</span><br><span class="line">  <span class="comment">// assigned as 1 when jalr uses other registers (general registers)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// check dependency</span></span><br><span class="line">  <span class="keyword">wire</span> jalr_rs1x1_dep = dec_i_valid &amp; dec_jalr &amp; dec_jalr_rs1x1 &amp; ((~oitf_empty) | (jalr_rs1idx_cam_irrdidx));</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  dependency occured at register x1:</span></span><br><span class="line"><span class="comment">  decode success, is a jalr instr., jalr and IR both use x1, OITF is not empty.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">wire</span> jalr_rs1xn_dep = dec_i_valid &amp; dec_jalr &amp; dec_jalr_rs1xn &amp; ((~oitf_empty) | (~ir_empty));</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  If the value of xn can only be determined until EXU, it is considered dependency exists.</span></span><br><span class="line"><span class="comment">  It is considered to have dependency only if IR is not empty, instead of comparing the register number.</span></span><br><span class="line"><span class="comment">  This is in fact a conservative method. </span></span><br><span class="line"><span class="comment">  Such design simplifies hardware logic and reduces the cost of area and power, </span></span><br><span class="line"><span class="comment">  though decreases performance at the same time.</span></span><br><span class="line"><span class="comment">  But since E203 is designed for ultra-low power, </span></span><br><span class="line"><span class="comment">  a little loss of performance is acceptable.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">wire</span> jalr_rs1xn_dep_ir_clr = (jalr_rs1xn_dep &amp; oitf_empty &amp; (~ir_empty)) &amp; (ir_valid_clr | (~ir_rs1en));</span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">  If only depend to IR stage (OITF is empty), then if IR is under clearing, </span></span><br><span class="line"><span class="comment">  or it does not use RS1 index, then we can also treat it as non-dependency</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// a FSM, determine the time to read value of rs1 to provide correct value for jalr</span></span><br><span class="line">  <span class="keyword">wire</span> rs1xn_rdrf_r; <span class="comment">// indicates whether CPU needs to read value from rs1</span></span><br><span class="line">  <span class="keyword">wire</span> rs1xn_rdrf_set = (~rs1xn_rdrf_r) &amp; dec_i_valid &amp; dec_jalr &amp; dec_jalr_rs1xn &amp; ((~jalr_rs1xn_dep) | jalr_rs1xn_dep_ir_clr);</span><br><span class="line">  <span class="keyword">wire</span> rs1xn_rdrf_clr = rs1xn_rdrf_r;</span><br><span class="line">  <span class="keyword">wire</span> rs1xn_rdrf_ena = rs1xn_rdrf_set |   rs1xn_rdrf_clr;</span><br><span class="line">  <span class="keyword">wire</span> rs1xn_rdrf_nxt = rs1xn_rdrf_set | (~rs1xn_rdrf_clr);</span><br><span class="line"></span><br><span class="line">  sirv_gnrl_dfflr <span class="variable">#(1) rs1xn_rdrf_dfflrs(rs1xn_rdrf_ena, rs1xn_rdrf_nxt, rs1xn_rdrf_r, clk, rst_n)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assign</span> bpu2rf_rs1_ena = rs1xn_rdrf_set;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assign</span> bpu_wait = jalr_rs1x1_dep | jalr_rs1xn_dep | rs1xn_rdrf_set;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// generate operation number 1</span></span><br><span class="line">  <span class="keyword">assign</span> prdt_pc_add_op1 = (dec_bxx | dec_jal) ? pc[`E203_PC_SIZE-<span class="number">1</span>:<span class="number">0</span>]</span><br><span class="line">                          <span class="comment">// if jalr uses x0, use constant 0</span></span><br><span class="line">                         : (dec_jalr &amp; dec_jalr_rs1x0) ? `E203_PC_SIZE'b0</span><br><span class="line">                         : (dec_jalr &amp; dec_jalr_rs1x1) ? rf2bpu_x1[`E203_PC_SIZE-<span class="number">1</span>:<span class="number">0</span>]</span><br><span class="line">                         : rf2bpu_rs1[`E203_PC_SIZE-<span class="number">1</span>:<span class="number">0</span>];  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// generate operation number 2: offset by immediate number</span></span><br><span class="line">  <span class="keyword">assign</span> prdt_pc_add_op2 = dec_bjp_imm[`E203_PC_SIZE-<span class="number">1</span>:<span class="number">0</span>];  </span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>In RISC-V structure,<br><code>x1</code> is used as a “Return Address” by default.<br>In most cases,<br><code>jal</code> and <code>jalr</code> will return the address of next instruction to <code>x1</code> if not specially designated.<br>Hence, in most cases the address will be stored in <code>x1</code>.<br>To improve performance,<br>E203 implied a special acceleration to <code>x1</code>.</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">wire</span> dec_jalr_rs1x1 = (dec_jalr_rs1idx == `E203_RFIDX_WIDTH'd1);</span><br><span class="line"><span class="comment">// assigned as 1 when jalr uses x1 (used as return address register)</span></span><br></pre></td></tr></table></figure></div>
<p>This line is used to judge whether <code>jalr</code> used <code>x1</code>.<br>Moreover, it needs to judge whether there is RAW dependency.<br>RAW dependency exists when </p>
<ul>
<li>OITF is not empty, meaning a long instruction is in execution. The result may be writen back to <code>x1</code>.<br>(Of course it can use other registers, but conserve estimation is applied here to reduce area. The performance loss is ignored.)</li>
<li>Instruction in IR register will write the result back to <code>x1</code>.</li>
</ul>
<p>So</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">wire</span> jalr_rs1x1_dep = dec_i_valid &amp; dec_jalr &amp; dec_jalr_rs1x1 &amp; ((~oitf_empty) | (jalr_rs1idx_cam_irrdidx));</span><br></pre></td></tr></table></figure></div>
<p>is used to indicate dependency. The following line</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> bpu_wait = jalr_rs1x1_dep | jalr_rs1xn_dep | rs1xn_rdrf_set;</span><br></pre></td></tr></table></figure></div>
<p>pulls up <code>bpu_wait</code> for one cycle if dependency is detected.<br>Such signal will stop next PC generation of IFU until RAW disappears.<br>In general, such a delay (stall) will cause a performance loss of one stall cycle.</p>
<p>If <code>jalr</code> uses other registers except <code>x0</code> and <code>x1</code>,<br>E203 did not apply special acceleration.<br>To read <code>xn</code>, the 1st read port of Regfile is required.<br>Only when the port is empty <code>xn</code> can be read.<br>Meanwhile, IR must be empty to prevent RAW<br>(Similarly, ignore the performance loss).<br>If both RAW and read port are free,<br>pull up the enable of the port and occupy it</p>
<div class="code-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">wire</span> rs1xn_rdrf_set = (~rs1xn_rdrf_r) &amp; dec_i_valid &amp; dec_jalr &amp; dec_jalr_rs1xn &amp; ((~jalr_rs1xn_dep) | jalr_rs1xn_dep_ir_clr);</span><br><span class="line"><span class="keyword">wire</span> rs1xn_rdrf_clr = rs1xn_rdrf_r;</span><br><span class="line"><span class="keyword">wire</span> rs1xn_rdrf_ena = rs1xn_rdrf_set |   rs1xn_rdrf_clr;</span><br><span class="line"><span class="keyword">wire</span> rs1xn_rdrf_nxt = rs1xn_rdrf_set | (~rs1xn_rdrf_clr);</span><br><span class="line"></span><br><span class="line">sirv_gnrl_dfflr <span class="variable">#(1) rs1xn_rdrf_dfflrs(rs1xn_rdrf_ena, rs1xn_rdrf_nxt, rs1xn_rdrf_r, clk, rst_n)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> bpu2rf_rs1_ena = rs1xn_rdrf_set;</span><br></pre></td></tr></table></figure></div>

<h3 id="Access-Memory"><a href="#Access-Memory" class="headerlink" title="Access Memory"></a>Access Memory</h3><p>To improve code density,<br>E203 supports 16bit compressed RISC-V instruction sets.<br>Therefore, 32bit instructions mix with 16bit ones,<br>introducing misaligned 32bit instructions.</p>
<div align="center">  
<img lazyload="" src="/images/loading.svg" data-src="/images/riscv_32align.png" width="400" height="300">  
</div>  
<center>Misaligned 32bit Instructions</center> 

<p>To deal with this,<br>E203 applies leftover buffer.<br>IFU fetches 32bits from the ITCM or BIU each time.<br>If IFU accesses ITCM,<br>since ITCM is composed of SRAM,<br>after reading, the value at the port will be hold-up (remains unchanged) until next reading.<br>Such property saves a 64bit register.</p>
<p>The bit-width of ITCM in E203 is 64bit.<br>One reading operation reads a 64bit data from the port, called a Lane.<br>When fetching by incrementing the address,<br>IFU fetches data from the same Lane multiple times since RISC-V instructions in E203 is at most 32bits long.<br>This reduces the times to read SRAM because IFU can read data from the hold-up port value until all data is read.</p>
<p>If a 32bit instruction crosses a 64bit boundary,<br>the leftover 16bit data will be stored in the leftover buffer<br>and raises a new access of SRAM.<br>The lowest 16bits of the new 64bit data from SRAM and the 16bits in the leftover buffer<br>will be concatenated into a complete 32bit instruction.<br>This is equivalent to fetching a 32bit instruction in one cycle,<br>without any performance loss.</p>
<p>If jump instruction or pipeline flush is encountered,<br>and the desired instruction crosses a 64bit boundary,<br>then two continuous SRAM readings are necessary.<br>This means the fetching must cost two cycles,<br>introducing one cycle loss.<br>E203 chooses to give up the optimization because it will bring too much extra area and consumption cost.</p>

		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Let&#39;s Read hbird_e203 CPU Together</li>
        <li><strong>Author:</strong> EleCannonic</li>
        <li><strong>Created at
                :</strong> 2025-09-09 00:00:00</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-12-27 18:11:07
            </li>
        
        <li>
            <strong>Link:</strong> https://elecannonic.github.io/categories/electronics/read_e203/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/categories/electronics/digital_integrate/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">Digital Integrated Circuits</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/categories/physics/quantum/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">Quantum Mechanics</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="giscus-container"></div>
    <script data-swup-reload-script defer>
        async function loadGiscus() {
            const giscusConfig = {
                'src': 'https://giscus.app/client.js',
                'data-repo': 'EleCannonic/blog_discussion',
                'data-repo-id': 'R_kgDOPxvgCw',
                'data-category': 'General',
                'data-category-id': 'DIC_kwDOPxvgC84Cvj7R',
                'data-mapping': 'pathname',
                'data-strict': '0',
                'data-reactions-enabled': '1',
                'data-emit-metadata': '1',
                'data-theme': 'preferred_color_scheme',
                'data-lang': 'en',
                'data-input-position': 'bottom',
                'data-loading': 'lazy',
                'crossorigin': 'anonymous',
                'async': true
            }
            const giscusScript = document.createElement('script');
            for (const key in giscusConfig) {
                giscusScript.setAttribute(key, giscusConfig[key]);
            }
            document.getElementById('giscus-container').appendChild(giscusScript);
        }
        if ('true') {
            let loadGiscusTimeout = setTimeout(() => {
                loadGiscus();
                clearTimeout(loadGiscusTimeout);
            }, 1000);
        } else {
            document.addEventListener('DOMContentLoaded', loadGiscus);
        }
    </script>


        
        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">Let&#39;s Read hbird_e203 CPU Together</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Instruction-Set-Architecture-ISA"><span class="nav-text">1. Instruction Set Architecture (ISA)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Standard-DFF-Registers"><span class="nav-text">2. Standard DFF Registers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-if-else-and-assign"><span class="nav-text">3. if-else and assign</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Data-Hazard"><span class="nav-text">4. Data Hazard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Instruction-Fetch-IF"><span class="nav-text">5. Instruction Fetch (IF)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ITCM"><span class="nav-text">ITCM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Non-aligned-Instructions"><span class="nav-text">Non-aligned Instructions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Branch-Instructions"><span class="nav-text">Branch Instructions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Branch-Prediction"><span class="nav-text">Branch Prediction</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-E200-IFU-Implementation"><span class="nav-text">6. E200 IFU Implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overall-Design-Concept"><span class="nav-text">Overall Design Concept</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mini-decode"><span class="nav-text">Mini-decode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ready-Valid-Handshake"><span class="nav-text">Ready&#x2F;Valid Handshake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple-BPU-Branch-Predictor"><span class="nav-text">Simple BPU Branch Predictor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Memory"><span class="nav-text">Access Memory</span></a></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2025</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">EleCannonic</a>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>


<script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/Swup.min.js" ></script><script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupSlideTheme.min.js" ></script><script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupScriptsPlugin.min.js" ></script><script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupProgressPlugin.min.js" ></script><script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupScrollPlugin.min.js" ></script><script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupPreloadPlugin.min.js" ></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	<script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/tools/imageViewer.js" ></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/utils.js" ></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/main.js" ></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/layouts/navbarShrink.js" ></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/tools/scrollTopBottom.js" ></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/tools/lightDarkSwitch.js" ></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/layouts/categoryList.js" ></script>


    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/tools/localSearch.js" ></script>



    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/tools/codeBlock.js" ></script>



    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/layouts/lazyload.js" ></script>



    <script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/tools/runtime.js" ></script>
    <script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/odometer.min.js" ></script>
    <link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/assets/odometer-theme-minimal.css">



  <script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/Typed.min.js" ></script>
  <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/plugins/typed.js" ></script>







    <script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/anime.min.js" ></script>




    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/plugins/tabs.js" data-swup-reload-script></script>


<script  src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script>
<script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.2/source/js/build/layouts/essays.js" data-swup-reload-script></script>




	
</body>

</html>